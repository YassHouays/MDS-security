<%- include('../../components/header'); -%>

<div class="px-6 lg:px-24 pb-6 h-auto my-10">
    
    <h2 class="text-gray-700 font-semibold text-3xl mb-3">Réglages</h2>

    <div class="flex flex-wrap -mx-4">
        <div class="w-full lg:w-1/2 px-4 mb-6">
            <div class="bg-white border-t border-b sm:rounded border">
                <div class="border-b">
                    <div class="flex justify-between px-6 -mb-px">
                        <h3 class="text-gray-800 py-4 font-normal text-lg">Informations personnelles</h3>
                    </div>
                </div>
                <div>
                    <div class="px-6 py-4">
                        <form method="post" id="personal_data_form">
                            <div class="flex flex-col">
                                <div class="-mx-3 md:flex mb-2">
                                    <div class="px-3">
                                        <label class="text-sm text-gray-700 mb-2" for="first_name">Prénom</label>
                                        <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="first_name" name="first_name" type="text" placeholder="John" value="<%if(user_data && user_data.first_name) {%><%= user_data.first_name %><%}%>">
                                        <%if(locals.errors && locals.errors['first_name']) {%><small class="text-xs text-red-500"><%= locals.errors['first_name'].message %></small><%}%>
                                    </div>
                                    <div class="px-3">
                                        <label class="text-sm text-gray-700 mb-2" for="last_name">Nom de famille</label>
                                        <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="last_name" name="last_name" type="text" placeholder="Doe" value="<%if(user_data && user_data.last_name) {%><%= user_data.last_name %><%}%>">
                                        <%if(locals.errors && locals.errors['last_name']) {%><small class="text-xs text-red-500"><%= locals.errors['last_name'].message %></small><%}%>
                                    </div>
                                </div>
                            </div>

                            <div class="-mx-3 md:flex mb-2">
                                <div class="px-3">
                                    <label class="text-sm text-gray-700 mb-2" for="username">Pseudo</label>
                                    <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="username" name="username" type="text" placeholder="John" value="<%if(user_data && user_data.username) {%><%= user_data.username %><%}%>">
                                    <%if(locals.errors && locals.errors['username']) {%><small class="text-xs text-red-500"><%= locals.errors['username'].message %></small><%}%>
                                </div>
                            </div>
            
                            <div class="-mx-3 md:flex mb-2">
                                <div class="px-3">
                                    <label class="text-sm text-gray-700 mb-2" for="birthday">Date de naissance</label>
                                    <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="birthday" name="birthday" type="text" placeholder="24/07/1998" value="<%if(user_data && user_data.birthday) {%><%= user_data.birthday %><%}%>">
                                    <%if(locals.errors && locals.errors['birthday']) {%><small class="text-xs text-red-500"><%= locals.errors['birthday'].message %></small><%}%>
                                </div>
                            </div>

                            <div class="-mx-3 md:flex mb-2">
                                <div class="px-3">
                                    <label class="text-sm text-gray-700 mb-2" for="tel">Téléphone</label>
                                    <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="tel" name="tel" type="tel" placeholder="0610111213" value="<%if(user_data && user_data.tel) {%><%= user_data.tel %><%}%>">
                                    <%if(locals.errors && locals.errors['tel']) {%><small class="text-xs text-red-500"><%= locals.errors['tel'].message %></small><%}%>
                                </div>
                            </div>

                            <div class="my-8"></div>
                            <div class="-mx-3 md:flex mb-2">
                                <div class="px-3">
                                    <label class="text-sm text-gray-700 mb-2" for="city">Ville</label>
                                    <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="city" name="city" type="text" placeholder="Paris" value="<%if(user_data && user_data.city) {%><%= user_data.city %><%}%>">
                                </div>
                                <div class="px-3">
                                    <label class="text-sm text-gray-700 mb-2" for="zip_code">Code postal</label>
                                    <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="zip_code" name="zip_code" type="number" placeholder="75001" value="<%if(user_data && user_data.zip_code) {%><%= user_data.zip_code %><%}%>">
                                </div>
                            </div>
                            <div class="-mx-3 md:flex mb-2">
                                <div class="px-3">
                                    <label class="text-sm text-gray-700 mb-2" for="adress">Adresse</label>
                                    <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="adress" name="adress" type="text" placeholder="Lorem Ipsum" value="<%if(user_data && user_data.adress) {%><%= user_data.adress %><%}%>">
                                </div>
                            </div>
            
                            <button class="bg-gray-700 hover:bg-primary-400 text-white py-1 px-2 rounded mt-4" name="action" value="save_personal_data">Sauvegarder</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="w-full lg:w-1/2 px-4 mb-6">
            <div class="bg-white border-t border-b sm:rounded border">
                <div class="border-b">
                    <div class="flex justify-between px-6 -mb-px">
                        <h3 class="text-blue-dark py-4 font-normal text-lg">Mot de passe</h3>
                    </div>
                </div>
                <div>
                    <div class="px-6 py-4">
                        <form method="post" id="password_form">
                            <div class="flex flex-col">
                                <div class="-mx-3 md:flex mb-2">
                                    <div class="px-3">
                                        <label class="text-sm text-gray-700 mb-2" for="password">Mot de passe</label>
                                        <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="password" name="password" type="password" placeholder="**********">
                                    </div>
                                </div>
                                <div class="-mx-3 md:flex mb-2">
                                    <div class="px-3">
                                        <label class="text-sm text-gray-700 mb-2" for="confirm_password">Confirmer le mot de passe</label>
                                        <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-2 px-3 focus:border-gray-600" id="confirm_password" name="confirm_password" type="password" placeholder="**********">
                                    </div>
                                </div>
                            </div>
                            <%if(locals.errors && locals.errors['password']) {%><div> <small class="text-xs text-red-500"><%= locals.errors['password'].message %></small> </div><%}%>

                            <button class="bg-gray-700 hover:bg-primary-400 text-white py-1 px-2 rounded mt-4" name="action" value="save_password">Sauvegarder</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="w-full lg:w-1/2 px-4 mb-6">
            <div class="bg-white border-t border-b sm:rounded border">
                <div class="border-b">
                    <div class="flex justify-between px-6 -mb-px">
                        <h3 class="text-blue-dark py-4 font-normal text-lg">Image de Profil</h3>
                    </div>
                </div>
                <div>
                    <div class="px-6 py-4">
                        <form method="post" id="medias_form" enctype="multipart/form-data">
                            <div class="flex flex-col">
                                <div>
                                    <% if(user_data.image_profile){ %>
                                        <div class="shadow h-24 w-24 mt-2 border-white overflow-hidden border-4">
                                            <img class="object-cover w-full h-full" alt="Image de profil" src="<%= options.base_url %>assets/doc/users/<%=user_data.id %>/<%=user_data.image_profile %>">
                                        </div>
                                    <% }else{ %>
                                        <div class="shadow h-24 w-24 mt-2 border-white overflow-hidden border-4">
                                            <img class="object-cover w-full h-full" alt="Image de profil" src="<%= options.base_url %>assets/default_image_profile.jpg">
                                        </div>
                                    <% } %>

                                    <div class="inline-flex items-center">
                                        <div class="overflow-hidden relative my-4 mr-4">
                                            <input class="cursor-pointer" type="file" name="profil_pic">
                                        </div>
                                    </div>
                                </div>
                                <%if(locals.errors && locals.errors['image_profile']) {%><small class="text-xs text-red-500"><%= locals.errors['image_profile'].message %></small><%}%>
                            </div>
                            <button class="bg-gray-700 hover:bg-primary-400 text-white py-1 px-2 rounded mt-4" name="action" value="save_medias">Sauvegarder</button>
                        
                            <% if(user_data.image_profile){ %>
                                <button class="bg-transparent hover:bg-red-500 text-red-500 border border-red-500 hover:text-white py-1 px-2 rounded mt-4" name="action" value="reset_medias"><i class="far fa-trash-alt"></i> Supprimer</button>
                            <% } %>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="flex flex-wrap -mx-4">
        <div class="w-full lg:w-1/2 px-4 mb-6">
            <div class="bg-white border-t border-b sm:rounded border">
                <div class="border-b">
                    <div class="flex justify-between px-6 -mb-px">
                        <h3 class="text-blue-dark py-4 font-normal text-lg">Mes données personnelles</h3>
                    </div>
                </div>
                <div>
                    <div class="px-6 py-4">
                        <div class="mb-6">
                            <p class="text-gray-700 mb-4">Vous pouvez demandez à obtenir une archive contenant l'ensemble de vos données. Celle-ci peut prendre juqu'à 30 jours à être envoyée !</p>
                            <a href="" class="bg-transparent hover:bg-primary-500 text-primary-500 border border-primary-500 hover:text-white py-1 px-2 rounded mt-4" >Demander une archive</a>
                        </div>
                        <%if(user_data && user_data.deletion_request == true) {%>
                            <div>
                                <p class="text-gray-700 mb-4">Une demande de suppression de votre compte a été faite le <%= user_data.date_deletion_request %> ! <span class="text-red-400">Vous pouvez encore annuler pendant x jours !</span></p>
                                <form action="" method="post">
                                    <button class="cursor-pointer bg-transparent hover:bg-primary-500 text-primary-500 border border-primary-500 hover:text-white py-1 px-2 rounded" name="action" value="undelete_account">Annuler la suppression de mon compte</button>
                                </form>
                            </div>
                        <%}else{%>
                            <div>
                                <p class="text-gray-700 mb-4">Vous pouvez supprimez votre compte, celui sera complétement anonymiser et vous ne pourrez plus y accéder! <span class="text-red-400">Attention ceci est irreversible !</span></p>
                                <a class="modal-btn delete-account-btn cursor-pointer bg-transparent hover:bg-red-500 text-red-500 border border-red-500 hover:text-white py-1 px-2 rounded mt-4" data-modal-dest="delete-account-modal" ><i class="far fa-trash-alt"></i> Supprimer mon compte</a>
                            </div>
                        <%}%>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>



<div id="delete-account-modal" class="modal fixed w-full h-100 inset-0 z-50 overflow-hidden flex justify-center items-center fadeOut" style="background: rgba(0,0,0,.7);display: none;">
	<div class="shadow-lg modal-container bg-white w-11/12 md:max-w-md mx-auto rounded z-50 overflow-y-auto">
		<div class="modal-content py-4 text-left px-6">

			<div class="flex justify-between items-center pb-3 text-gray-800">
				<p class="text-2xl font-semibold text-red-500">Supprimer mon compte</p>
				<div class="modal-close-btn cursor-pointer z-50">
					<i class="fa fa-times"></i>
				</div>
            </div>
            
			<div class="mt-2 mb-4">
                <p class="text-gray-700 mb-4">Êtes-vous sûr de vouloir supprimer votre compte ? Vous aurez 14 jours pour annuler cette demande avant la suppression définitive</p>
            </div>

            <div class="flex justify-between items-center pb-3">
                <a class="modal-close-btn cursor-pointer bg-transparent hover:bg-gray-700 text-gray-700 border border-gray-700 hover:text-white py-1 px-2 rounded mt-4" >Annuler</a>
                <form action="" method="post">
                    <button class="modal-close-btn cursor-pointer bg-transparent hover:bg-red-500 text-red-500 border border-red-500 hover:text-white py-1 px-2 rounded mt-4" name="action" value="delete_account">Oui je confirme</button>
                </form>
            </div>
            
		</div>
	</div>
</div>

<%- include('../../components/footer'); -%>
